// Generated by CoffeeScript 1.9.3
var getkeyvalue, htmlstring, putmodel, target, value;

getkeyvalue = function(url) {
  return $.ajax({
    url: url,
    dataType: 'json',
    async: false
  }).done(function(data) {
    return data;
  }).fail(function() {
    return alert("获取失败！请刷新页面");
  }).always(function() {
    return console.log("complete");
  });
};

putmodel = function(string, array) {
  var a, b, dataType, defaultvalue, fieldid, fieldname, html, i, id, itemlength, j, k, len, len1, mend, ref, ref1, ref2, str, title, v;
  html = "";
  for (i = 0, len = array.length; i < len; i++) {
    a = array[i];
    title = a.classname;
    id = a["class"];
    html = "<div id='" + id + "' class='content'> <h1>" + title + "</h1>";
    ref = a.childfield;
    for (j = 0, len1 = ref.length; j < len1; j++) {
      b = ref[j];
      fieldname = b.fieldname;
      fieldid = b.field;
      dataType = b.datatype;
      defaultvalue = b["default"];
      mend = "";
      if (dataType === 'selecttext') {
        str = "";
        itemlength = b.items.length;
        ref1 = b.items;
        for (k in ref1) {
          v = ref1[k];
          if (v === "其他______") {
            v = v.split('_')[0];
            str += "<input type='radio' class='" + fieldid + " other' name='" + fieldid + "' value='" + v + "'/>" + v + "<input type='text' class='otherdata' id='" + fieldid + "_other'/>";
          } else {
            str += "<input type='radio' class='" + fieldid + "' name='" + fieldid + "' value='" + v + "'/>" + v;
          }
          if (v.length >= 10) {
            str += "<br / >";
            if (itemlength >= 5 || fieldid === 'NenYuanLiYongKeZaiShengNenYuanZhiJieLiYong' || fieldid === 'NenYuanLiYongKeZaiShengNenYuanZhuanHuanLiYong') {
              mend = "style='height:250px'";
            } else {
              mend = "style='height:180px'";
            }
          }
        }
      } else if (dataType === 'mutiselecttext') {
        str = "";
        ref2 = b.items;
        for (k in ref2) {
          v = ref2[k];
          str += "<input type='checkbox' class='" + fieldid + "' name='" + fieldid + "' value='" + v + "'/>" + v;
        }
      } else {
        str = "<input type='text' id='" + fieldid + "' name='" + fieldid + "' />";
      }
      html += "<div class='list' " + mend + "> <div class='note'> <h3>" + fieldname + "</h3> </div> <div class='input'> " + str + " </div> </div>";
    }
    html += "</div><hr />";
    string += html;
  }
  return $('#J_form').append(string);
};

value = JSON.parse(getkeyvalue('/input/field').responseText);

htmlstring = "";

putmodel(htmlstring, value);

target = "";

$('.other').on('click', function() {
  var b, brothers, i, input, len, that;
  target = $(this).attr('class').split(' ')[0];
  input = $("#" + target + "_other");
  input.css('display', 'inline-block');
  brothers = $(this).prevAll();
  for (i = 0, len = brothers.length; i < len; i++) {
    b = brothers[i];
    $(b).on('click', function() {
      return input.css('display', 'none');
    });
  }
  that = this;
  return input.on('blur', function() {
    return $(that).val($(this).val());
  });
});
